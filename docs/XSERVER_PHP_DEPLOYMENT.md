# XサーバーへのPHP版デプロイ手順（段階的ガイド）

## 📋 現在の状況

- ✅ Xサーバーのドメイン取得済み
- ✅ PHP版のコード準備済み（`php-version/`フォルダ）
- ⏳ デプロイ作業は未実施

## 🎯 目標

スマホでアクセスできるように、XサーバーにPHP版アプリをデプロイする

---

## 📝 ステップ1: Xサーバーの情報確認

### 1-1. Xサーバーのコントロールパネルにログイン

1. Xサーバーのコントロールパネルにアクセス
2. ログイン情報を確認

### 1-2. 必要な情報を確認

以下の情報をXサーバーのコントロールパネルで確認してください：

**確認事項：**
- [ ] FTPサーバー名（例: `ftp.example.com`）
- [ ] FTPユーザー名
- [ ] FTPパスワード
- [ ] ドメイン名（例: `example.com`）
- [ ] 公開ディレクトリ（通常は `public_html`）

**次のステップに進むために、これらの情報を準備してください。**

---

## 📝 ステップ2: データベースの作成

### 2-1. MySQLデータベースを作成

1. Xサーバーのコントロールパネルにログイン
2. 「データベース」→「MySQLデータベース作成」をクリック
3. 以下の情報を設定：
   - データベース名（例: `matchtune_db`）
   - ユーザー名（例: `matchtune_user`）
   - パスワード（強力なパスワードを設定）

**作成後、以下の情報をメモしてください：**
- データベース名: `_________________`
- ユーザー名: `_________________`
- パスワード: `_________________`

### 2-2. データベーステーブルの作成

1. Xサーバーのコントロールパネルで「phpMyAdmin」を開く
2. 作成したデータベースを選択
3. `php-version/database/schema.sql` の内容を実行

---

## 📝 ステップ3: 設定ファイルの編集

### 3-1. データベース接続情報の設定

1. `php-version/config/database.php.template` を `database.php` にコピー
2. Xサーバーのデータベース情報を入力：
   ```php
   define('DB_HOST', 'localhost');
   define('DB_NAME', '実際のデータベース名');
   define('DB_USER', '実際のユーザー名');
   define('DB_PASS', '実際のパスワード');
   ```

### 3-2. アプリケーション設定の編集

1. `php-version/config/config.php.template` を `config.php` にコピー（既に存在する場合は上書き）
2. ベースURLを設定：
   ```php
   define('BASE_URL', 'https://取得済みのドメイン名');
   ```

---

## 📝 ステップ4: ファイルの準備

### 4-1. 必要なファイルの確認

PHP版に必要なファイルが揃っているか確認します。

**必要なファイル/フォルダ：**
- [ ] `api/` フォルダ（すべてのAPIファイル）
- [ ] `assets/` フォルダ（CSS、JS）
- [ ] `config/` フォルダ（設定ファイル）
- [ ] `data/compatibility-54/` フォルダ（JSONファイル）
- [ ] `lib/` フォルダ（ライブラリ）
- [ ] `index.php`, `diagnosis.php`, `join.php`, `result.php`
- [ ] `.htaccess` ファイル

### 4-2. ランク画像の確認

Next.js版の `public/rank-images/` フォルダから、PHP版の `rank-images/` フォルダに画像をコピーする必要があります。

**必要な画像：**
- SSランク画像
- Sランク画像
- Aランク画像
- Bランク画像
- Cランク画像
- Dランク画像
- Eランク画像
- Fランク画像
- Gランク画像

### 4-3. logsディレクトリの作成

`php-version/logs/` ディレクトリが存在することを確認してください（既に存在する場合はOK）。

---

## 📝 ステップ5: FTPでファイルをアップロード

### 5-1. FTPクライアントの準備

FileZillaなどのFTPクライアントを使用します。

**FTP接続情報：**
- ホスト: XサーバーのFTPサーバー名
- ユーザー名: FTPユーザー名
- パスワード: FTPパスワード
- ポート: 21（通常）

### 5-2. ファイルのアップロード先

Xサーバーの公開ディレクトリ（通常は `public_html`）にアップロードします。

**アップロード先の例：**
```
public_html/
  └── matchtune/  (または任意のディレクトリ名)
      ├── api/
      ├── assets/
      ├── config/
      ├── data/
      ├── lib/
      ├── logs/
      ├── rank-images/
      ├── index.php
      ├── diagnosis.php
      ├── join.php
      ├── result.php
      └── .htaccess
```

### 5-3. パーミッションの設定

アップロード後、SSHまたはFTPクライアントで以下のパーミッションを設定：

```bash
chmod 755 logs/
chmod 644 .htaccess
chmod 644 config/*.php
```

---

## 📝 ステップ6: 動作確認

### 6-1. 基本的な動作確認

1. ブラウザで `https://your-domain.com/matchtune/index.php` にアクセス
2. 「ペアを作成する」ボタンをクリック
3. ペアコードが表示されることを確認
4. QRコードが表示されることを確認

### 6-2. 診断フローの確認

1. ペアコードを生成
2. 別のブラウザ（またはスマホ）で参加
3. 質問に回答
4. 結果が表示されることを確認

### 6-3. エラーの確認

エラーが発生した場合：
- `logs/error.log` を確認
- ブラウザの開発者ツール（F12）でコンソールエラーを確認
- データベース接続情報を再確認

---

## 🔄 次のアクション

**まず、以下を教えてください：**

1. **XサーバーのFTP情報**
   - FTPサーバー名: `_________________`
   - FTPユーザー名: `_________________`
   - FTPパスワード: `_________________`（安全に管理）

2. **取得済みのドメイン名**
   - 例: `example.com` または `example.xsrv.jp`

3. **データベース作成の準備**
   - データベースを作成しましたか？
   - まだの場合、作成手順を案内します

この情報をいただければ、次のステップに進みます！

---

## 📌 チェックリスト（デプロイ前）

デプロイ前に、以下をすべて確認してください：

- [ ] XサーバーのFTP情報を取得
- [ ] MySQLデータベースを作成
- [ ] `database/schema.sql` を実行してテーブルを作成
- [ ] `config/database.php` にデータベース情報を設定
- [ ] `config/config.php` にベースURLを設定
- [ ] `rank-images/` フォルダに画像を配置
- [ ] `logs/` ディレクトリが存在することを確認
- [ ] すべてのファイルをFTPでアップロード
- [ ] パーミッションを設定
- [ ] 動作確認を実施

---

## 🐛 トラブルシューティング

### データベース接続エラー
- `config/database.php` の接続情報を確認
- Xサーバーのデータベースが作成されているか確認
- phpMyAdminで接続テストを実施

### ファイルが見つからないエラー
- ファイルパスが正しいか確認
- `data/compatibility-54/` 内のJSONファイルが存在するか確認
- `.htaccess` が正しく配置されているか確認

### 権限エラー
- `logs/` ディレクトリの書き込み権限を確認（755推奨）

### 画像が表示されない
- `rank-images/` フォルダに画像が配置されているか確認
- 画像ファイル名が正しいか確認
